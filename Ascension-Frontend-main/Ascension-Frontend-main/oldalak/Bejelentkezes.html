<!DOCTYPE html>
<html lang="hu">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Belépés | Ascension</title>
    <link
      href="https://fonts.googleapis.com/css2?family=Bebas+Neue&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="../assets/css/main_style.css" />
  </head>
  <body class="auth-page">
    <div
      class="auth-card"
      role="dialog"
      aria-labelledby="auth-title"
      aria-describedby="auth-desc"
    >
      <div class="auth-header">
        <h1 id="auth-title">Belépés</h1>
        <p id="auth-desc">
          Hozz létre fiókot vagy jelentkezz be, hogy folytasd a főoldalra.
        </p>
      </div>

      <div
        class="auth-tabs"
        role="tablist"
        aria-label="Regisztráció / Bejelentkezés"
      >
        <button
          id="tab-login"
          class="auth-tab active"
          role="tab"
          aria-selected="true"
          aria-controls="panel-login"
        >
          Bejelentkezés
        </button>
        <button
          id="tab-register"
          class="auth-tab"
          role="tab"
          aria-selected="false"
          aria-controls="panel-register"
        >
          Regisztráció
        </button>
      </div>

      <section id="panel-login" role="tabpanel" aria-labelledby="tab-login">
        <form id="login-form" novalidate>
          <div class="field">
            <label for="login-email">Email</label>
            <input
              id="login-email"
              type="email"
              name="email"
              placeholder="pelda@domain.hu"
              required
            />
            <div class="helper">Használd a regisztrált email címedet.</div>
          </div>
          <div class="field">
            <label for="login-password">Jelszó</label>
            <input
              id="login-password"
              type="password"
              name="password"
              placeholder="••••••••"
              required
              minlength="6"
            />
          </div>
          <div class="error" id="login-error" aria-live="polite"></div>
          <div class="actions">
            <button type="submit" class="btn btn-primary">Belépés</button>
            <a href="../index.html" class="btn btn-secondary" role="button"
              >Vissza</a
            >
          </div>
        </form>
      </section>

      <section
        id="panel-register"
        role="tabpanel"
        aria-labelledby="tab-register"
        hidden
      >
        <form id="register-form" novalidate>
          <div class="field">
            <label for="reg-name">Név</label>
            <input
              id="reg-name"
              type="text"
              name="name"
              placeholder="Teljes név"
              required
            />
          </div>
          <div class="field">
            <label for="reg-email">Email</label>
            <input
              id="reg-email"
              type="email"
              name="email"
              placeholder="pelda@domain.hu"
              required
            />
          </div>
          <div class="field">
            <label for="reg-password">Jelszó</label>
            <input
              id="reg-password"
              type="password"
              name="password"
              placeholder="legalább 6 karakter"
              required
              minlength="6"
            />
          </div>
          <div class="error" id="register-error" aria-live="polite"></div>
          <div class="success" id="register-success" aria-live="polite"></div>
          <div class="actions">
            <button type="submit" class="btn btn-primary">Regisztráció</button>
            <a href="../index.html" class="btn btn-secondary" role="button"
              >Vissza</a
            >
          </div>
        </form>
      </section>
    </div>

    <script>
      // Tab switching
      const tabLogin = document.getElementById("tab-login");
      const tabRegister = document.getElementById("tab-register");
      const panelLogin = document.getElementById("panel-login");
      const panelRegister = document.getElementById("panel-register");

      function activateTab(which) {
        const isLogin = which === "login";
        tabLogin.classList.toggle("active", isLogin);
        tabRegister.classList.toggle("active", !isLogin);
        tabLogin.setAttribute("aria-selected", String(isLogin));
        tabRegister.setAttribute("aria-selected", String(!isLogin));
        panelLogin.hidden = !isLogin;
        panelRegister.hidden = isLogin;
      }

      tabLogin.addEventListener("click", () => activateTab("login"));
      tabRegister.addEventListener("click", () => activateTab("register")); // =========================================
      // AUTH SYSTEM - Ready for API integration
      // =========================================

      const loginForm = document.getElementById("login-form");
      const registerForm = document.getElementById("register-form");
      const loginError = document.getElementById("login-error");
      const registerError = document.getElementById("register-error");
      const registerSuccess = document.getElementById("register-success");

      // API endpoint configuration (set this when backend is ready)
      const API_BASE_URL = ""; // e.g., 'http://localhost:3000/api' or 'https://api.ascension.hu'

      // Session management
      function saveUserSession(user) {
        localStorage.setItem("ascension_user", JSON.stringify(user));
        localStorage.setItem("ascension_token", user.token || ""); // JWT token amikor API lesz
      }

      function clearUserSession() {
        localStorage.removeItem("ascension_user");
        localStorage.removeItem("ascension_token");
      }

      function getUserSession() {
        try {
          return JSON.parse(localStorage.getItem("ascension_user"));
        } catch {
          return null;
        }
      }

      // =========================================
      // MOCK FUNCTIONS (localStorage based)
      // Replace these with API calls when backend is ready
      // =========================================

      function getUsers() {
        try {
          return JSON.parse(localStorage.getItem("ascension_users")) || [];
        } catch {
          return [];
        }
      }

      function saveUsers(list) {
        localStorage.setItem("ascension_users", JSON.stringify(list));
      }

      // Mock registration - REPLACE with API call
      async function mockRegister(userData) {
        return new Promise((resolve, reject) => {
          setTimeout(() => {
            const users = getUsers();
            if (users.some((u) => u.email === userData.email)) {
              reject(new Error("Ezzel az email címmel már létezik fiók."));
              return;
            }
            users.push(userData);
            saveUsers(users);
            resolve({ success: true, message: "Sikeres regisztráció!" });
          }, 500); // Simulate network delay
        });
      }

      // Mock login - REPLACE with API call
      async function mockLogin(email, password) {
        return new Promise((resolve, reject) => {
          setTimeout(() => {
            const users = getUsers();
            const found = users.find(
              (u) => u.email === email && u.password === password
            );
            if (!found) {
              reject(new Error("Hibás email vagy jelszó."));
              return;
            }
            resolve({
              success: true,
              user: {
                name: found.name,
                email: found.email,
                token: "mock_jwt_token_" + Date.now(), // Mock JWT token
              },
            });
          }, 500); // Simulate network delay
        });
      }

      // =========================================
      // REGISTRATION HANDLER
      // =========================================
      registerForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        registerError.textContent = "";
        registerSuccess.textContent = "";

        const name = document.getElementById("reg-name").value.trim();
        const email = document
          .getElementById("reg-email")
          .value.trim()
          .toLowerCase();
        const password = document.getElementById("reg-password").value;

        // Validation
        if (!name || !email || !password || password.length < 6) {
          registerError.textContent =
            "Kérjük, töltsd ki helyesen az összes mezőt (min. 6 karakteres jelszó).";
          return;
        }

        // Disable submit button during request
        const submitBtn = registerForm.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.textContent = "Regisztráció...";

        try {
          // TODO: Replace with actual API call when backend is ready
          // const response = await fetch(`${API_BASE_URL}/auth/register`, {
          //   method: 'POST',
          //   headers: { 'Content-Type': 'application/json' },
          //   body: JSON.stringify({ name, email, password })
          // });
          // const data = await response.json();

          const data = await mockRegister({ name, email, password });

          // Success - show message and switch to login tab
          registerSuccess.textContent =
            "Sikeres regisztráció! Most már bejelentkezhetsz.";
          registerForm.reset();

          // Auto-switch to login tab after 2 seconds
          setTimeout(() => {
            activateTab("login");
            // Pre-fill email in login form
            document.getElementById("login-email").value = email;
            document.getElementById("login-password").focus();
          }, 2000);
        } catch (error) {
          registerError.textContent =
            error.message || "Hiba történt a regisztráció során.";
        } finally {
          submitBtn.disabled = false;
          submitBtn.textContent = "Regisztráció";
        }
      });

      // =========================================
      // LOGIN HANDLER - ONLY THIS LOGS IN USER
      // =========================================
      loginForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        loginError.textContent = "";

        const email = document
          .getElementById("login-email")
          .value.trim()
          .toLowerCase();
        const password = document.getElementById("login-password").value;

        // Validation
        if (!email || !password) {
          loginError.textContent =
            "Kérjük, add meg az email címed és jelszavad.";
          return;
        }

        // Disable submit button during request
        const submitBtn = loginForm.querySelector('button[type="submit"]');
        submitBtn.disabled = true;
        submitBtn.textContent = "Belépés...";

        try {
          // TODO: Replace with actual API call when backend is ready
          // const response = await fetch(`${API_BASE_URL}/auth/login`, {
          //   method: 'POST',
          //   headers: { 'Content-Type': 'application/json' },
          //   body: JSON.stringify({ email, password })
          // });
          // const data = await response.json();

          const data = await mockLogin(email, password);

          // Success - save session and redirect
          saveUserSession(data.user);
          window.location.href = "../oldalak/main.html";
        } catch (error) {
          loginError.textContent =
            error.message || "Hiba történt a bejelentkezés során.";
          submitBtn.disabled = false;
          submitBtn.textContent = "Belépés";
        }
      });
    </script>
  </body>
</html>
